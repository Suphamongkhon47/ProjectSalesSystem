{% load tailwind_tags %}
<!doctype html>
<html lang="th" data-theme="light">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>{% if is_edit %}‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç{% else %}‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°{% endif %}‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</title>
  {% tailwind_css %}
</head>
<body class="bg-gradient-to-br from-slate-50 to-slate-100">

<div class="flex min-h-screen">
  
  {# Sidebar #}
  {% include "partials/sidebar.html" %}
  
  {# Main Content #}
  <main class="flex-1 p-6 lg:p-8 overflow-y-auto">
    <div class="max-w-[800px] mx-auto">
      
      {# ========== Header ========== #}
      <div class="mb-6">
        <h1 class="text-3xl font-bold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent mb-2">
          {% if is_edit %}
            ‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: {{ employee.nickname }}
          {% else %}
            ‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà
          {% endif %}
        </h1>
        <p class="text-slate-600">‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</p>
      </div>
      
      {# Messages #}
      {% include "partials/messages.html" %}
      
      {# ========== Form ========== #}
      <form method="post" enctype="multipart/form-data" class="space-y-6">
        {% csrf_token %}
        
        {# ========== 1. ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ (‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà) ========== #}
        {% if not is_edit %}
        <div class="card bg-white shadow-lg border border-slate-200">
          <div class="card-body p-6">
            <h2 class="flex items-center gap-2 text-lg font-bold text-slate-800 mb-4">
              üîê ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
            </h2>
            <div class="grid gap-4">
              <div class="form-control">
                <label class="label"><span class="label-text font-semibold">Username *</span></label>
                <input type="text" name="username" class="input input-bordered" placeholder="‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô" required>
              </div>
              <div class="grid md:grid-cols-2 gap-4">
                <div class="form-control">
                  <label class="label"><span class="label-text font-semibold">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô *</span></label>
                  <input type="password" name="password" class="input input-bordered" required>
                </div>
                <div class="form-control">
                  <label class="label"><span class="label-text font-semibold">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô *</span></label>
                  <input type="password" name="confirm_password" class="input input-bordered" required>
                </div>
              </div>
            </div>
          </div>
        </div>
        {% endif %}

        {# ========== 2. ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô (‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ï‡∏≠‡∏ô‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç) ========== #}
        {% if is_edit %}
        <div class="card bg-white shadow-lg border border-slate-200">
          <div class="card-body p-6">
            <h2 class="flex items-center gap-2 text-lg font-bold text-slate-800 mb-2">
              üîê ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô
            </h2>
            
            <div class="form-control">
              <label class="label cursor-pointer justify-start gap-3">
                <input type="checkbox" name="change_password" id="changePasswordCheck" class="checkbox checkbox-primary">
                <span class="label-text font-medium">‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà</span>
              </label>
            </div>

            {# Hidden Fields #}
            <div id="passwordFields" class="hidden mt-4 p-4 bg-slate-50 rounded-lg border border-slate-200  md:grid-cols-2 gap-4">
               <div class="form-control">
                  <label class="label"><span class="label-text font-semibold">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà</span></label>
                  <input type="password" name="new_password" class="input input-bordered">
               </div>
               <div class="form-control">
                  <label class="label"><span class="label-text font-semibold">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</span></label>
                  <input type="password" name="confirm_password" class="input input-bordered">
               </div>
               <div class="col-span-2">
                 <div class="alert alert-warning text-sm shadow-sm">
                   <span>‚ö†Ô∏è ‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏£‡πâ‡∏≤‡∏ô‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ï‡∏±‡πâ‡∏á‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà‡πÉ‡∏´‡πâ‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏π‡πâ‡∏£‡∏´‡∏±‡∏™‡πÄ‡∏î‡∏¥‡∏°</span>
                 </div>
               </div>
            </div>
          </div>
        </div>
        {% endif %}

        {# ========== 3. ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß & ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û ========== #}
        <div class="card bg-white shadow-lg border border-slate-200">
          <div class="card-body p-6">
            <h2 class="flex items-center gap-2 text-lg font-bold text-slate-800 mb-4">
              üë§ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß
            </h2>
            
            {# --- ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û --- #}
            <div class="flex flex-col md:flex-row gap-6 mb-6 items-center md:items-start">
              <div class="avatar">
                <div class="w-32 rounded-xl ring ring-primary ring-offset-base-100 ring-offset-2">
                  {# ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏£‡∏π‡∏õ‡πÄ‡∏î‡∏¥‡∏° (Base64) ‡πÉ‡∏´‡πâ‡πÇ‡∏ä‡∏ß‡πå ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏ä‡πâ‡∏£‡∏π‡∏õ Default #}
                  {% if form_data.avatar %}
                    <img id="previewImg" src="{{ form_data.avatar }}" alt="Avatar" />
                  {% else %}
                    <img id="previewImg" src="https://ui-avatars.com/api/?name={{ form_data.nickname|default:'User' }}&background=random" alt="Avatar" />
                  {% endif %}
                </div>
              </div>
              <div class="form-control w-full max-w-xs">
                <label class="label"><span class="label-text font-semibold">‡∏£‡∏π‡∏õ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå</span></label>
                <input type="file" name="avatar" class="file-input file-input-bordered w-full" accept="image/*" onchange="previewImage(event)">
                <label class="label">
                  <span class="label-text-alt text-slate-500">‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå JPG, PNG (‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 5MB)</span>
                </label>
              </div>
            </div>

            <div class="grid md:grid-cols-2 gap-4">
              {# ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô #}
              <div class="form-control">
                <label class="label"><span class="label-text font-semibold">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô *</span></label>
                <input type="text" name="nickname" class="input input-bordered" value="{{ form_data.nickname }}" required>
              </div>
              
              {# ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£ #}
              <div class="form-control">
                <label class="label"><span class="label-text font-semibold">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</span></label>
                <input type="text" name="phone" class="input input-bordered" value="{{ form_data.phone }}">
              </div>
              
              {# ‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• #}
              <div class="form-control">
                <label class="label"><span class="label-text font-semibold">‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏£‡∏¥‡∏á *</span></label>
                <input type="text" name="first_name" class="input input-bordered" value="{{ form_data.first_name }}" required>
              </div>
              <div class="form-control">
                <label class="label"><span class="label-text font-semibold">‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• *</span></label>
                <input type="text" name="last_name" class="input input-bordered" value="{{ form_data.last_name }}" required>
              </div>
              
              {# ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà #}
              <div class="form-control md:col-span-2">
                <label class="label"><span class="label-text font-semibold">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà</span></label>
                <textarea name="address" class="textarea textarea-bordered h-24">{{ form_data.address }}</textarea>
              </div>
            </div>
          </div>
        </div>
        
        {# ========== 4. ‡∏Å‡∏≤‡∏£‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå (Superuser Only) ========== #}
        {% if is_edit and request.user.is_superuser %}
          <div class="card bg-white shadow-lg border border-slate-200">
            <div class="card-body p-6">
              <h2 class="flex items-center gap-2 text-lg font-bold text-slate-800 mb-4">
                <div class="bg-gradient-to-br from-yellow-400 to-orange-500 p-2 rounded-lg">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
                  </svg>
                </div>
                ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
              </h2>
                <div class="form-control">
                  <label class="label">
                    <span class="label-text font-semibold text-slate-700">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á *</span>
                  </label>
                  <select name="role_selection" class="select select-bordered text-base bg-yellow-50">
                    <option value="EMPLOYEE" {% if not employee.user.is_superuser %}selected{% endif %}>
                      üîµ ‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ (Manager) - ‡∏Ç‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á ‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏ï‡πá‡∏≠‡∏Å
                    </option>
                    <option value="OWNER" {% if employee.user.is_superuser %}selected{% endif %}>
                      üëë ‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏£‡πâ‡∏≤‡∏ô (Superuser) - ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î
                    </option>
                  </select>
                </div>
            </div>
          </div>
        {% endif %}
        
        {# ‡∏õ‡∏∏‡πà‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å #}
        <div class="flex gap-2 pt-4">
          <button type="submit" class="btn btn-primary gap-2 flex-1 shadow-lg text-lg">
            üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
          </button>
          <a href="{% url 'employee_list' %}" class="btn btn-ghost text-lg">
             ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
          </a>
        </div>
      </form>
      
    </div>
  </main>
</div>

{# Script: ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Toggle Password ‡πÅ‡∏•‡∏∞ Preview ‡∏£‡∏π‡∏õ #}
<script>
  // 1. Toggle Password Fields
  const check = document.getElementById('changePasswordCheck');
  const fields = document.getElementById('passwordFields');
  if(check && fields){
    check.addEventListener('change', function(){
      if(this.checked) fields.classList.remove('hidden');
      else fields.classList.add('hidden');
    });
  }

  // 2. Preview Image
  function previewImage(event) {
    const reader = new FileReader();
    reader.onload = function(){
      const output = document.getElementById('previewImg');
      output.src = reader.result;
    }
    reader.readAsDataURL(event.target.files[0]);
  }
</script>

</body>
</html>