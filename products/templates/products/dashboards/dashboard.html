{% load static %}
{% load humanize %}
<!DOCTYPE html>
<html lang="th" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìä Dashboard - {% if is_owner %}Owner{% else %}Staff{% endif %}</title>
    {% load tailwind_tags %}
    {% tailwind_css %}
</head>
<body class="bg-base-200">
<div class="flex min-h-screen">
    
    {# Sidebar #}
    {% include "partials/sidebar.html" %}
    
    {# Main Content #}
    <main class="flex-1 p-6">
        
        {# Header #}
        <div class="mb-6 flex flex-col md:flex-row justify-between items-center gap-4">
            <div>
                <h1 class="text-3xl font-bold">üìä Dashboard</h1>
                <p class="text-gray-600">
                    ‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ, <span class="font-bold text-primary">{{ request.user.username }}</span>
                </p>
            </div>

            {# ‚úÖ ‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà #}
            <div class="flex items-center gap-3 bg-white p-2 rounded-lg shadow-sm">
                
                {# ‡∏õ‡∏∏‡πà‡∏°‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö 1 ‡∏ß‡∏±‡∏ô: ‡πÉ‡∏ä‡πâ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ prev_date #}
                <a href="?date={{ prev_date|date:'Y-m-d' }}" class="btn btn-square btn-sm btn-ghost">
                    ‚ùÆ
                </a>

                {# Form ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà #}
                <form action="" method="get" class="flex items-center gap-2">
                    <div class="form-control">
                        <input type="date" 
                            name="date" 
                            value="{{ report_date|date:'Y-m-d' }}" 
                            class="input input-bordered input-sm"
                            onchange="this.form.submit()"> 
                    </div>
                </form>

                {# ‡∏õ‡∏∏‡πà‡∏°‡πÑ‡∏õ‡∏ß‡∏±‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ: ‡πÉ‡∏ä‡πâ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ next_date #}
                <a href="?date={{ next_date|date:'Y-m-d' }}" class="btn btn-square btn-sm btn-ghost">
                    ‚ùØ
                </a>
                
                {# ‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ #}
                <a href="{% url 'home_dashboard' %}" class="btn btn-sm btn-primary ml-2">‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</a>
            </div>

            <div>
                {% if is_owner %}
                    <span class="badge badge-primary badge-lg">üëë ‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£/‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á</span>
                {% else %}
                    <span class="badge badge-info badge-lg">üë§ ‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏Ç‡∏≤‡∏¢</span>
                {% endif %}
            </div>
        </div>
        
        {# Stats Cards #}
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
            
            {# CARD 1: Main Metric #}
            <div class="card {% if is_owner %}bg-gradient-to-br from-blue-600 to-blue-700{% else %}bg-gradient-to-br from-cyan-500 to-cyan-600{% endif %} text-white shadow-xl">
                <div class="card-body">
                    <h2 class="card-title text-sm opacity-90">
                        {% if is_owner %}üí∞ ‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ{% else %}üì¶ ‡∏ö‡∏¥‡∏•‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏¥‡∏î‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ{% endif %}
                    </h2>
                    <p class="text-3xl font-bold">
                        {% if is_owner %}
                            {{ today_sales_money|floatformat:0|intcomma }} ‡∏ø
                        {% else %}
                            {{ today_bills|default:0 }} ‡πÉ‡∏ö
                        {% endif %}
                    </p>
                    <div class="text-sm opacity-90">
                        {% if is_increase %}
                            <span class="text-green-200">‚Üó +{{ change_percent|floatformat:1 }}%</span>
                        {% else %}
                            <span class="text-red-200">‚Üò {{ change_percent|floatformat:1 }}%</span>
                        {% endif %}
                        ‡∏à‡∏≤‡∏Å‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ß‡∏≤‡∏ô
                    </div>
                </div>
            </div>
            
            {# CARD 2: Profit/Items #}
            <div class="card {% if is_owner %}bg-gradient-to-br from-purple-600 to-purple-700{% else %}bg-gradient-to-br from-orange-500 to-orange-600{% endif %} text-white shadow-xl">
                <div class="card-body">
                    <h2 class="card-title text-sm opacity-90">
                        {% if is_owner %}üìà ‡∏Å‡∏≥‡πÑ‡∏£‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ{% else %}üîß ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏¢{% endif %}
                    </h2>
                    <p class="text-3xl font-bold">
                        {% if is_owner %}
                            {{ today_profit|floatformat:0|intcomma }} ‡∏ø
                        {% else %}
                            {{ today_items_count|default:0 }} ‡∏ä‡∏¥‡πâ‡∏ô
                        {% endif %}
                    </p>
                    <div class="text-sm opacity-90">
                        {% if is_owner %}
                            {{ today_profit_margin|floatformat:1 }}% Margin
                        {% else %}
                            ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ç‡∏¢‡∏±‡∏ô‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Ç‡∏≠‡∏á
                        {% endif %}
                    </div>
                </div>
            </div>
            
            {# CARD 3: Bills/Goal #}
            <div class="card bg-gradient-to-br from-gray-700 to-gray-800 text-white shadow-xl">
                <div class="card-body">
                    <h2 class="card-title text-sm opacity-90">
                        {# ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡πÉ‡∏´‡πâ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô #}
                        {% if is_owner %}üßæ ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ö‡∏¥‡∏•‡∏£‡∏ß‡∏°{% else %}üéØ ‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô{% endif %}
                    </h2>
                    <p class="text-3xl font-bold">
                        {% if is_owner %}
                            {{ today_bills|default:0 }} ‡∏ö‡∏¥‡∏•
                        {% else %}
                            {# ‚úÖ ‡πÅ‡∏Å‡πâ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ: ‡∏î‡∏∂‡∏á‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏°‡∏≤‡πÅ‡∏™‡∏î‡∏á (‡∏°‡∏µ‡∏•‡∏π‡∏Å‡∏ô‡πâ‡∏≥‡∏Ñ‡∏±‡πà‡∏ô) #}
                            {{ today_sales_money|floatformat:0|intcomma }} ‡∏ø
                        {% endif %}
                    </p>
                    <div class="text-sm opacity-90">
                        {% if is_owner and today_bills > 0 %}
                            ‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢: {% widthratio today_sales_money today_bills 1 %} ‡∏ø/‡∏ö‡∏¥‡∏•
                        {% elif is_owner %}
                            ‡∏£‡∏≠‡∏ö‡∏¥‡∏•‡πÅ‡∏£‡∏Å
                        {% else %}
                            {# ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏´‡πâ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÉ‡∏à‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô #}
                            ‡∏™‡∏π‡πâ‡πÜ ‡∏Ñ‡∏£‡∏±‡∏ö‚úåÔ∏è
                        {% endif %}
                    </div>
                </div>
            </div>
            
            {# CARD 4: Discount/Motivate #}
            {% if is_owner %}
            <div class="card bg-gradient-to-br from-red-500 to-red-600 text-white shadow-xl">
                <div class="card-body">
                    <h2 class="card-title text-sm opacity-90">üéÅ ‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î‡∏ó‡∏µ‡πà‡πÉ‡∏´‡πâ‡πÑ‡∏õ</h2>
                    <p class="text-3xl font-bold">{{ today_sales.total_discount|floatformat:0|default:0|intcomma }} ‡∏ø</p>
                    <div class="text-sm opacity-90">‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡∏ö‡∏¥‡∏•</div>
                </div>
            </div>
            {% else %}
            <div class="card bg-base-100 shadow-xl border border-base-300">
                <div class="card-body flex items-center justify-center text-gray-400">
                    <div class="text-center">
                        <div class="text-2xl">üí™</div>
                        <div class="text-sm">‡∏™‡∏π‡πâ‡πÜ ‡∏Ñ‡∏£‡∏±‡∏ö</div>
                    </div>
                </div>
            </div>
            {% endif %}
            
        </div>
        
        {# ‚úÖ ‡πÅ‡∏ñ‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏™‡∏ï‡πá‡∏≠‡∏Å (‡πÄ‡∏â‡∏û‡∏≤‡∏∞ Owner) #}
        {% if is_owner and low_stock_count > 0 or out_of_stock_count > 0 %}
        <div class="alert alert-warning shadow-lg mb-6">
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current flex-shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                </svg>
                <div>
                    <h3 class="font-bold">‚ö†Ô∏è ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏™‡∏ï‡πá‡∏≠‡∏Å!</h3>
                    <div class="text-sm">
                        {% if low_stock_count > 0 %}
                            ‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ <strong>{{ low_stock_count }}</strong> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ ‡∏ó‡∏µ‡πà‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏ï‡πà‡∏≥ (‚â§10 ‡∏ä‡∏¥‡πâ‡∏ô)
                        {% endif %}
                        {% if out_of_stock_count > 0 %}
                            {% if low_stock_count > 0 %}‡πÅ‡∏•‡∏∞{% endif %}
                            <strong class="text-error">{{ out_of_stock_count }}</strong> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏´‡∏°‡∏î‡∏™‡∏ï‡πá‡∏≠‡∏Å
                        {% endif %}
                    </div>
                </div>
            </div>
            <div class="flex-none">
                <a href="#low-stock-section" class="btn btn-sm btn-ghost">‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ ‚Üì</a>
            </div>
        </div>
        {% endif %}
        
        {# Content Grid #}
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            
            {# Chart: ‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢ 7 ‡∏ß‡∏±‡∏ô #}
            <div class="card bg-white shadow-xl">
                <div class="card-body">
                    <h2 class="card-title flex justify-between">
                        <span>
                            {% if is_owner %}üìà ‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢ (‡∏ö‡∏≤‡∏ó){% else %}üìä ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏¥‡∏î‡∏ö‡∏¥‡∏• (‡πÉ‡∏ö){% endif %}
                        </span>
                        <span class="text-sm font-normal text-gray-500">7 ‡∏ß‡∏±‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</span>
                    </h2>
                    
                    <div class="flex items-end justify-between h-48 mt-6 pb-2 border-b border-gray-200">
                        {% for day in last_7_days %}
                        <div class="flex flex-col items-center flex-1 group relative">
                            <div class="opacity-0 group-hover:opacity-100 absolute bottom-full mb-2 bg-gray-800 text-white text-xs rounded py-1 px-2 transition-opacity whitespace-nowrap z-10">
                                {{ day.total|floatformat:0|intcomma }} {% if is_owner %}‡∏ø{% else %}‡πÉ‡∏ö{% endif %}
                            </div>
                            
                            <div class="w-full mx-1 rounded-t transition-all hover:opacity-80 
                                        {% if is_owner %}bg-blue-500{% else %}bg-cyan-500{% endif %}"
                                 style="height: {% if day.total > 0 %}{{ day.total|floatformat:0|add:20 }}px{% else %}4px{% endif %}; max-height: 160px;">
                            </div>
                            
                            <div class="text-xs mt-2 text-gray-500 font-medium">{{ day.day_name }}</div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
            
            {# Table: TOP 5 ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ #}
            <div class="card bg-white shadow-xl">
                <div class="card-body">
                    <h2 class="card-title">
                        {% if is_owner %}üî• ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏≥‡πÄ‡∏á‡∏¥‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ{% else %}üîß ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏≠‡∏≠‡∏Å‡πÄ‡∏¢‡∏≠‡∏∞‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ{% endif %}
                    </h2>
                    
                    <div class="overflow-x-auto mt-4">
                        <table class="table w-full">
                            <thead>
                                <tr>
                                    <th class="w-10">#</th>
                                    <th>‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
                                    <th class="text-right">
                                        {% if is_owner %}‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢{% else %}‡∏à‡∏≥‡∏ô‡∏ß‡∏ô{% endif %}
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for product in top_products_today %}
                                <tr class="hover">
                                    <th>{{ forloop.counter }}</th>
                                    <td>
                                        <div class="font-bold">{{ product.product__name }}</div>
                                        <div class="text-xs text-gray-500">SKU: {{ product.product__sku }}</div>
                                    </td>
                                    <td class="text-right">
                                        {% if is_owner %}
                                            <div class="font-bold text-success">{{ product.total_amount|floatformat:0|intcomma }} ‡∏ø</div>
                                            <div class="text-xs text-gray-500">{{ product.total_qty|floatformat:0 }} ‡∏ä‡∏¥‡πâ‡∏ô</div>
                                        {% else %}
                                            <div class="font-bold text-primary">{{ product.total_qty|floatformat:0 }} ‡∏ä‡∏¥‡πâ‡∏ô</div>
                                        {% endif %}
                                    </td>
                                </tr>
                                {% empty %}
                                <tr>
                                    <td colspan="3" class="text-center text-gray-500 py-8">
                                        ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="card-actions justify-end mt-4">
                        <a href="{% url 'daily_top_products' %}" class="btn btn-ghost btn-sm">
                            ‡∏î‡∏π‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ‚Üí
                        </a>
                    </div>
                </div>
            </div>
            
            {# Payment Methods #}
            <div class="card bg-white shadow-xl">
                <div class="card-body">
                    <h2 class="card-title flex justify-between">
                        <span>
                            {% if is_owner %}üí≥ ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î{% else %}üí∞ ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏â‡∏±‡∏ô‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô{% endif %}
                        </span>
                        <span class="text-xs font-normal text-gray-500">‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</span>
                    </h2>
                    
                    <div class="space-y-3 mt-4">
                        {% for payment in recent_payments %}
                        <div class="flex items-center justify-between p-3 bg-base-100 rounded-lg border border-base-200">
                            
                            <div class="flex items-center gap-3">
                                {# ‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó #}
                                {% if payment.method == 'cash' %}
                                    <div class="w-10 h-10 rounded-full bg-green-100 flex items-center justify-center text-green-600 text-xl" title="‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î">üíµ</div>
                                {% elif payment.method == 'qr' %}
                                    <div class="w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 text-xl" title="QR Code">üì±</div>
                                {% else %}
                                    <div class="w-10 h-10 rounded-full bg-purple-100 flex items-center justify-center text-purple-600 text-xl" title="‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô">üè¶</div>
                                {% endif %}
                                
                                <div>
                                    <div class="font-bold text-sm">
                                        {# ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏ö‡∏¥‡∏• #}
                                        {{ payment.sale.doc_no|default:"-" }}
                                    </div>
                                    <div class="text-xs text-gray-500">
                                        {# ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏ß‡∏•‡∏≤ ‡πÅ‡∏•‡∏∞ ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ä‡∏≥‡∏£‡∏∞ #}
                                        {{ payment.created_at|date:"H:i" }} ‡∏ô. ‚Ä¢ 
                                        {% if payment.method == 'cash' %}‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î
                                        {% elif payment.method == 'qr' %}QR Code
                                        {% else %}‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô{% endif %}
                                    </div>
                                </div>
                            </div>
                            
                            <div class="text-right">
                                <div class="font-bold text-lg text-primary">
                                    {{ payment.amount|floatformat:0|intcomma }} ‡∏ø
                                </div>
                                
                                {# ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á ‡πÉ‡∏´‡πâ‡πÄ‡∏´‡πá‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏ô‡∏Ç‡∏≤‡∏¢‡∏î‡πâ‡∏ß‡∏¢ #}
                                {% if is_owner %}
                                    <div class="text-[10px] text-gray-400">
                                        ‡πÇ‡∏î‡∏¢: {{ payment.sale.created_by.username }}
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                        {% empty %}
                        <div class="text-center text-gray-500 py-6">
                            ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ
                        </div>
                        {% endfor %}
                    </div>
                    
                    <div class="card-actions justify-end mt-2">
                        <a href="{% url 'sale_list' %}" class="btn btn-ghost btn-xs">‡∏î‡∏π‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ‚Üí</a>
                    </div>
                </div>
            </div>

            {# Quick Links #}
            <div class="card bg-white shadow-xl">
                <div class="card-body">
                    <h2 class="card-title">üîó ‡πÄ‡∏°‡∏ô‡∏π‡∏î‡πà‡∏ß‡∏ô</h2>
                    <div class="grid grid-cols-2 gap-3 mt-4">
                        <a href="{% url 'sales' %}" class="btn btn-primary">
                            üõí ‡∏Ç‡∏≤‡∏¢‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (POS)
                        </a>
                        <a href="{% url 'sale_list' %}" class="btn btn-outline">
                            üìã ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ö‡∏¥‡∏•
                        </a>
                        <a href="{% url 'daily_top_products' %}" class="btn btn-outline">
                            üî• ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ç‡∏≤‡∏¢‡∏î‡∏µ
                        </a>
                        {% if is_owner %}
                        <a href="{% url 'sales_summary' %}" class="btn btn-outline">
                            üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢
                        </a>
                        {% endif %}
                    </div>
                </div>
            </div>
            
            {# ‚úÖ ‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ï‡πà‡∏≥/‡∏´‡∏°‡∏î (‡πÄ‡∏â‡∏û‡∏≤‡∏∞ Owner) #}
            {% if is_owner %}
            <div class="card bg-white shadow-xl lg:col-span-2" id="low-stock-section">
                <div class="card-body">
                    <div class="flex items-center justify-between mb-4">
                        <h2 class="card-title">‚ö†Ô∏è ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏ï‡πà‡∏≥ / ‡∏´‡∏°‡∏î‡∏™‡∏ï‡πá‡∏≠‡∏Å</h2>
                        <div class="flex gap-2">
                            {% if low_stock_count > 0 %}
                                <div class="badge badge-warning badge-lg">{{ low_stock_count }} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div>
                            {% endif %}
                            {% if out_of_stock_count > 0 %}
                                <div class="badge badge-error badge-lg">{{ out_of_stock_count }} ‡∏´‡∏°‡∏î</div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="overflow-x-auto">
                        <table class="table table-zebra w-full">
                            <thead>
                                <tr>
                                    <th class="w-10">#</th>
                                    <th>SKU</th>
                                    <th>‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
                                    <th class="text-right">‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</th>
                                    <th class="text-right">‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤ (‡∏ö‡∏≤‡∏ó)</th>
                                    <th class="text-center">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for product in low_stock_products %}
                                <tr class="{% if product.quantity == 0 %}bg-red-50{% endif %}">
                                    <th>{{ forloop.counter }}</th>
                                    <td class="font-mono text-xs">{{ product.sku }}</td>
                                    <td>
                                        <div class="font-bold">{{ product.name }}</div>
                                        {% if product.category %}
                                            <div class="text-xs text-gray-500">{{ product.category.name }}</div>
                                        {% endif %}
                                    </td>
                                    <td class="text-right">
                                        <span class="font-bold {% if product.quantity == 0 %}text-error{% elif product.quantity <= 5 %}text-warning{% endif %}">
                                            {{ product.quantity|floatformat:0 }} {{ product.unit }}
                                        </span>
                                    </td>
                                    <td class="text-right text-sm">
                                        {% widthratio product.quantity 1 product.cost_price %} ‡∏ø
                                    </td>
                                    <td class="text-center">
                                        {% if product.quantity == 0 %}
                                            <span class="badge badge-error">‡∏´‡∏°‡∏î</span>
                                        {% elif product.quantity <= 5 %}
                                            <span class="badge badge-warning">‡∏ï‡πà‡∏≥‡∏°‡∏≤‡∏Å</span>
                                        {% else %}
                                            <span class="badge badge-warning">‡∏ï‡πà‡∏≥</span>
                                        {% endif %}
                                    </td>
                                </tr>
                                {% empty %}
                                <tr>
                                    <td colspan="6" class="text-center text-gray-500 py-8">
                                        <div class="text-2xl mb-2">‚úÖ</div>
                                        <div>‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏õ‡∏Å‡∏ï‡∏¥‡∏î‡∏µ ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ï‡πà‡∏≥</div>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    
                    {% if low_stock_products or out_of_stock_count > 0 %}
                    <div class="card-actions justify-between mt-4">
                        <div class="text-sm text-gray-600">
                            üí° <strong>‡πÄ‡∏Ñ‡∏•‡πá‡∏î‡∏•‡∏±‡∏ö:</strong> ‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ñ‡∏á‡∏Ñ‡∏•‡∏±‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: <strong class="text-primary">{{ inventory_value|floatformat:0|intcomma }} ‡∏ø</strong>
                        </div>
                        <a href="{% url 'import_product' %}" class="btn btn-warning btn-sm">
                            üì¶ ‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°
                        </a>
                    </div>
                    {% endif %}
                </div>
            </div>
            {% endif %}
            
        </div>
        
    </main>
    
</div>
</body>
</html>