{% load static %}
{% load humanize %}
<!DOCTYPE html>
<html lang="th" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìä Dashboard</title>
    {% load tailwind_tags %}
    {% tailwind_css %}
    
    {# Chart.js CDN #}
    <script src="{% static 'js/chart.js' %}"></script>

    <style>
        /* ‡πÉ‡∏ä‡πâ Font ‡∏ó‡∏µ‡πà‡∏î‡∏π‡∏ó‡∏±‡∏ô‡∏™‡∏°‡∏±‡∏¢ */
        body { 
            font-family: 'Inter', 'Sarabun', sans-serif; 
            background-color: #f8f9fc; /* ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏™‡∏µ‡πÄ‡∏ó‡∏≤‡∏≠‡∏°‡∏ü‡πâ‡∏≤‡∏ô‡∏¥‡∏î‡πÜ ‡πÉ‡∏´‡πâ‡∏î‡∏π‡∏™‡∏ß‡πà‡∏≤‡∏á‡∏ï‡∏≤ */
        }
        
        /* ‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÅ‡∏ö‡∏ö‡πÉ‡∏´‡∏°‡πà: ‡πÄ‡∏ô‡πâ‡∏ô‡πÄ‡∏á‡∏≤‡∏ô‡∏∏‡πà‡∏°‡πÜ ‡∏Ç‡∏≠‡∏ö‡∏°‡∏ô‡πÜ */
        .card-modern {
            background-color: white;
            border-radius: 1rem; /* rounded-2xl */
            /* ‡πÄ‡∏á‡∏≤‡πÅ‡∏ö‡∏ö‡∏ô‡∏∏‡πà‡∏°‡∏ô‡∏ß‡∏• ‡πÑ‡∏°‡πà‡πÅ‡∏Ç‡πá‡∏á */
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.03), 0 4px 6px -2px rgba(0, 0, 0, 0.02);
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.5); /* ‡∏Ç‡∏≠‡∏ö‡∏Ç‡∏≤‡∏ß‡∏à‡∏≤‡∏á‡πÜ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏°‡∏¥‡∏ï‡∏¥ */
        }
        .card-modern:hover { 
            transform: translateY(-3px); 
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.05), 0 10px 10px -5px rgba(0, 0, 0, 0.02);
        }
        
        /* ‡∏Å‡∏•‡πà‡∏≠‡∏á‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡πÅ‡∏ö‡∏ö‡∏ß‡∏á‡∏Å‡∏•‡∏° ‡∏û‡∏£‡πâ‡∏≠‡∏° Gradient ‡πÄ‡∏ö‡∏≤‡πÜ */
        .icon-circle {
            width: 56px; 
            height: 56px; 
            border-radius: 50%; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-size: 1.75rem;
            /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏™‡∏á‡πÄ‡∏á‡∏≤‡πÉ‡∏´‡πâ‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡∏î‡∏π‡∏ô‡∏π‡∏ô */
            box-shadow: inset 0 2px 4px 0 rgba(255, 255, 255, 0.3), 0 4px 6px -1px rgba(0, 0, 0, 0.05);
        }
    </style>
</head>
<body class="text-slate-700">
<div class="flex min-h-screen">
    
    {# Sidebar #}
    {% include "partials/sidebar.html" %}
    
    {# Main Content #}
    <main class="flex-1 p-6 lg:p-8 overflow-x-hidden">
        
        {# --- Header Section --- #}
        <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-8">
            <div>
                <h1 class="text-3xl font-extrabold text-slate-800 tracking-tight">Dashboard</h1>
                <p class="text-slate-500 mt-1 text-base">
                    ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏Å‡∏•‡∏±‡∏ö, <span class="font-bold text-indigo-600">{{ request.user.username }}</span> 
                    <span class="text-xs bg-indigo-50 text-indigo-600 px-2 py-0.5 rounded-full font-medium ml-1">
                        {% if is_owner %}Administrator{% else %}Sales Staff{% endif %}
                    </span>
                </p>
            </div>

            {# Date Filter (‡∏õ‡∏£‡∏±‡∏ö‡πÉ‡∏´‡πâ‡∏î‡∏π‡∏ô‡∏∏‡πà‡∏°‡∏Ç‡∏∂‡πâ‡∏ô) #}
            <div class="bg-white p-1.5 rounded-xl shadow-sm flex items-center gap-2 border border-gray-100">
                <form action="" method="get" class="flex items-center gap-2">
                    <input type="date" name="start_date" value="{{ start_date|date:'Y-m-d' }}" 
                           class="input input-sm border-0 bg-gray-50 focus:bg-indigo-50 focus:ring-0 rounded-lg text-slate-600 text-xs w-32 font-medium">
                    <span class="text-slate-300">‚Üí</span>
                    <input type="date" name="end_date" value="{{ end_date|date:'Y-m-d' }}" 
                           class="input input-sm border-0 bg-gray-50 focus:bg-indigo-50 focus:ring-0 rounded-lg text-slate-600 text-xs w-32 font-medium">
                    
                    <button type="submit" class="btn btn-sm bg-indigo-600 hover:bg-indigo-700 text-white border-0 min-h-0 h-8 px-4 text-xs rounded-lg shadow-sm font-medium">
                        ‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                    </button>
                </form>
                <div class="h-5 w-px bg-gray-200 mx-2"></div>
                <div class="flex gap-1">
                    <a href="{% url 'home_dashboard' %}" class="btn btn-xs btn-ghost text-slate-500 font-medium hover:bg-gray-100 rounded-lg">‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</a>
                    <a href="?start_date={{ date_7_days_ago|date:'Y-m-d' }}&end_date={{ actual_today|date:'Y-m-d' }}" class="btn btn-xs btn-ghost text-slate-500 font-medium hover:bg-gray-100 rounded-lg">7 ‡∏ß‡∏±‡∏ô</a>
                </div>
            </div>
        </div>
        
        {# --- Stats Cards (‡∏ä‡∏∏‡∏î‡∏™‡∏µ‡πÉ‡∏´‡∏°‡πà) --- #}
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            
            {# Card 1: Sales (Theme: Indigo) #}
            <div class="card-modern p-6 relative overflow-hidden">
                {# Decorative Background Blob #}
                <div class="absolute -top-4 -right-4 w-24 h-24 bg-indigo-50 rounded-full opacity-50 blur-2xl pointer-events-none"></div>
                
                <div class="flex justify-between items-start relative z-10">
                    <div>
                        <p class="text-sm font-semibold text-indigo-900/60 uppercase tracking-wider">
                            {% if is_owner %}‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏™‡∏∏‡∏ó‡∏ò‡∏¥{% else %}‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô{% endif %}
                        </p>
                        <h3 class="text-3xl font-extrabold text-slate-800 mt-2 leading-tight">{{ net_sales|floatformat:0|intcomma }} ‡∏ø</h3>
                    </div>
                    <div class="icon-circle bg-gradient-to-br from-indigo-100 to-indigo-50 text-indigo-600">
                        üí∞
                    </div>
                </div>
                <div class="mt-4 flex items-center text-sm font-medium">
                    {% if is_increase %}
                        <span class="text-emerald-600 flex items-center bg-emerald-50/80 px-2 py-0.5 rounded-full">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M12 7l-5-5-5 5 1.414 1.414L7 4.414V17h2V4.414l4.086 4.086L12 7z" clip-rule="evenodd" /></svg>
                            {{ change_percent|floatformat:1 }}%
                        </span>
                    {% else %}
                        <span class="text-rose-600 flex items-center bg-rose-50/80 px-2 py-0.5 rounded-full">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M12 13l-5 5-5-5 1.414-1.414L7 15.586V3h2v12.586l4.086-4.086L12 13z" clip-rule="evenodd" /></svg>
                            {{ change_percent|floatformat:1 }}%
                        </span>
                    {% endif %}
                    <span class="text-slate-400 ml-2 text-xs">‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏ä‡πà‡∏ß‡∏á‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤</span>
                </div>
            </div>
            
            {# Card 2: Profit/Items (Theme: Emerald) #}
            <div class="card-modern p-6 relative overflow-hidden">
                 <div class="absolute -top-4 -right-4 w-24 h-24 bg-emerald-50 rounded-full opacity-50 blur-2xl pointer-events-none"></div>
                <div class="flex justify-between items-start relative z-10">
                    <div>
                        <p class="text-sm font-semibold text-emerald-900/60 uppercase tracking-wider">
                            {% if is_owner %}‡∏Å‡∏≥‡πÑ‡∏£‡∏™‡∏∏‡∏ó‡∏ò‡∏¥{% else %}‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ä‡∏¥‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏¢{% endif %}
                        </p>
                        <h3 class="text-3xl font-extrabold text-slate-800 mt-2 leading-tight">
                            {% if is_owner %}
                                {{ net_profit|floatformat:0|intcomma }} ‡∏ø
                            {% else %}
                                {{ net_items_count|floatformat:0 }} ‡∏ä‡∏¥‡πâ‡∏ô
                            {% endif %}
                        </h3>
                    </div>
                    <div class="icon-circle bg-gradient-to-br from-emerald-100 to-emerald-50 text-emerald-600">
                        {% if is_owner %}üìà{% else %}üì¶{% endif %}
                    </div>
                </div>
                <div class="mt-4 text-sm font-medium text-slate-500">
                    {% if is_owner %}
                        Margin: <span class="text-emerald-600 font-bold">{{ net_profit_margin|floatformat:1 }}%</span>
                    {% else %}
                        ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏¢‡∏≠‡∏≠‡∏Å‡πÑ‡∏õ
                    {% endif %}
                </div>
            </div>
            
            {# Card 3: Bills (Theme: Sky Blue) #}
            <div class="card-modern p-6 relative overflow-hidden">
                 <div class="absolute -top-4 -right-4 w-24 h-24 bg-sky-50 rounded-full opacity-50 blur-2xl pointer-events-none"></div>
                <div class="flex justify-between items-start relative z-10">
                    <div>
                        <p class="text-sm font-semibold text-sky-900/60 uppercase tracking-wider">
                            {% if is_owner %}‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ö‡∏¥‡∏•‡∏£‡∏ß‡∏°{% else %}‡∏ö‡∏¥‡∏•‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏¥‡∏î{% endif %}
                        </p>
                        <h3 class="text-3xl font-extrabold text-slate-800 mt-2 leading-tight">{{ total_bills|intcomma }} ‡πÉ‡∏ö</h3>
                    </div>
                    <div class="icon-circle bg-gradient-to-br from-sky-100 to-sky-50 text-sky-600">
                        üßæ
                    </div>
                </div>
                <div class="mt-4 text-sm font-medium text-slate-500">
                    {% if total_bills > 0 %}
                        ‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢: <span class="font-semibold">{{ avg_bill|floatformat:0|intcomma }}</span> ‡∏ø/‡∏ö‡∏¥‡∏•
                    {% else %}
                        ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢
                    {% endif %}
                </div>
            </div>
            
            {# Card 4: Inventory/Action (Theme: Amber) #}
            <div class="card-modern p-6 relative overflow-hidden">
                <div class="absolute -top-4 -right-4 w-24 h-24 bg-amber-50 rounded-full opacity-50 blur-2xl pointer-events-none"></div>
                {% if is_owner %}
                    <div class="flex justify-between items-start relative z-10">
                        <div>
                            <p class="text-sm font-semibold text-amber-900/60 uppercase tracking-wider">‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏™‡∏ï‡πá‡∏≠‡∏Å</p>
                            <h3 class="text-3xl font-extrabold text-slate-800 mt-2 leading-tight">{{ inventory_value|floatformat:0|intcomma }} ‡∏ø</h3>
                        </div>
                        <div class="icon-circle bg-gradient-to-br from-amber-100 to-amber-50 text-amber-600">
                            üè≠
                        </div>
                    </div>
                    <div class="mt-4 text-sm font-medium text-slate-500">‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
                {% else %}
                    <div class="flex flex-col h-full justify-between relative z-10">
                        <div>
                            <p class="text-sm font-semibold text-indigo-900/60 uppercase tracking-wider">‡∏ó‡∏≤‡∏á‡∏•‡∏±‡∏î</p>
                            <h3 class="text-xl font-bold text-slate-800 mt-2">‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Ç‡∏≤‡∏¢‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á?</h3>
                        </div>
                        <a href="{% url 'sales' %}" class="btn bg-indigo-600 hover:bg-indigo-700 text-white border-0 w-full mt-4 rounded-xl shadow-sm font-medium flex items-center justify-center gap-2">
                            <span>üõí</span> ‡πÄ‡∏õ‡∏¥‡∏î‡∏ö‡∏¥‡∏•‡∏Ç‡∏≤‡∏¢‡πÉ‡∏´‡∏°‡πà
                        </a>
                    </div>
                {% endif %}
            </div>
            
        </div>
        
        {# --- Alerts (Admin Only) - ‡∏õ‡∏£‡∏±‡∏ö‡πÉ‡∏´‡πâ‡∏î‡∏π‡∏ô‡∏∏‡πà‡∏°‡∏Ç‡∏∂‡πâ‡∏ô --- #}
        {% if is_owner and out_of_stock_count > 0 %}
        <div class="alert shadow-sm mb-8 rounded-xl border-0 bg-rose-50 text-rose-700 flex items-center p-4 relative overflow-hidden">
             <div class="absolute inset-0 bg-rose-100 opacity-50 blur-xl pointer-events-none"></div>
            <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6 relative z-10" fill="none" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" /></svg>
            <span class="text-sm font-semibold ml-2 relative z-10">‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô: ‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ <strong class="text-rose-800 text-base">{{ out_of_stock_count }}</strong> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ ‡∏´‡∏°‡∏î‡∏™‡∏ï‡πá‡∏≠‡∏Å! ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</span>
        </div>
        {% endif %}
        
        {# --- Charts & Tables Section --- #}
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            
            {# Chart: 7 Days Trend #}
            <div class="card-modern p-6 lg:col-span-2">
                <div class="flex justify-between items-center mb-6">
                    <div>
                        <h3 class="font-bold text-slate-800 text-lg">
                            {% if is_owner %}üìâ ‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢{% else %}üìä ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢{% endif %}
                        </h3>
                        <p class="text-sm text-slate-500 font-medium">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• 7 ‡∏ß‡∏±‡∏ô‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á</p>
                    </div>
                </div>
                
                <div class="relative h-72 w-full">
                    <canvas id="salesChart"></canvas>
                </div>
            </div>
            
            {# Top Products #}
            <div class="card-modern p-0 overflow-hidden flex flex-col">
                <div class="p-5 border-b border-gray-100">
                    <h3 class="font-bold text-slate-800 text-lg flex items-center gap-2">
                        <span class="text-amber-500">üèÜ</span> ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ç‡∏≤‡∏¢‡∏î‡∏µ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ
                    </h3>
                </div>
                <div class="divide-y divide-gray-50 flex-1 overflow-y-auto">
                    {% for p in top_products %}
                    <div class="p-5 flex justify-between items-center hover:bg-gray-50/50 transition-colors">
                        {# ‡πÄ‡∏≠‡∏≤ Avatar ‡∏≠‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÅ‡∏Ñ‡πà‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞ SKU #}
                        <div class="min-w-0 pr-4">
                            <div class="font-bold text-sm text-slate-700 truncate">{{ p.product__name }}</div>
                            <div class="text-xs text-slate-400 font-mono mt-0.5">{{ p.product__sku }}</div>
                        </div>
                        
                        <div class="text-right shrink-0">
                            <div class="font-bold text-base text-indigo-600">{{ p.total_qty|floatformat:0 }} <span class="text-xs font-medium text-indigo-400">‡∏ä‡∏¥‡πâ‡∏ô</span></div>
                            {% if is_owner %}
                                <div class="text-xs text-slate-400 font-medium mt-0.5">{{ p.total_amount|floatformat:0|intcomma }} ‡∏ø</div>
                            {% endif %}
                        </div>
                    </div>
                    {% empty %}
                    <div class="p-12 text-center flex flex-col items-center justify-center text-slate-400">
                         <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 opacity-50 mb-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4" /></svg>
                        <span class="text-sm font-medium">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</span>
                    </div>
                    {% endfor %}
                </div>
            </div>
            
            {# Recent Payments #}
            <div class="card-modern p-0 overflow-hidden lg:col-span-3">
                <div class="p-5 border-b border-gray-100 flex justify-between items-center bg-gray-50/30">
                    <h3 class="font-bold text-slate-800 text-lg flex items-center gap-2">
                        <span class="text-blue-500">üí≥</span> ‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
                    </h3>
                    <a href="{% url 'sales_report' %}" class="btn btn-xs btn-ghost text-indigo-600 hover:bg-indigo-50 font-medium rounded-lg">‡∏î‡∏π‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ‚Üí</a>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full text-sm text-left">
                        <thead class="text-xs text-slate-500 uppercase bg-white border-b border-gray-100">
                            <tr>
                                <th class="px-6 py-4 font-semibold tracking-wider">‡πÄ‡∏ß‡∏•‡∏≤</th>
                                <th class="px-6 py-4 font-semibold tracking-wider">‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏ö‡∏¥‡∏•</th>
                                <th class="px-6 py-4 font-semibold tracking-wider">‡∏ß‡∏¥‡∏ò‡∏µ‡∏ä‡∏≥‡∏£‡∏∞</th>
                                <th class="px-6 py-4 font-semibold tracking-wider text-right">‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô</th>
                                {% if is_owner %}<th class="px-6 py-4 font-semibold tracking-wider">‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</th>{% endif %}
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-50 bg-white">
                            {% for pay in recent_payments %}
                            <tr class="hover:bg-gray-50/50 transition-colors">
                                <td class="px-6 py-4 text-slate-500 font-medium whitespace-nowrap">
                                    <div class="text-sm">{{ pay.created_at|date:"d/m/Y" }}</div>
                                    <div class="text-xs text-slate-400">{{ pay.created_at|date:"H:i" }} ‡∏ô.</div>
                                </td>
                                <td class="px-6 py-4 font-semibold text-indigo-600 whitespace-nowrap">{{ pay.transaction.doc_no }}</td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    {% if pay.method == 'cash' %}
                                        <span class="inline-flex items-center gap-1.5 text-emerald-700 bg-emerald-50 px-2.5 py-1 rounded-full text-xs font-semibold">üíµ ‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î</span>
                                    {% elif pay.method == 'qr' %}
                                        <span class="inline-flex items-center gap-1.5 text-blue-700 bg-blue-50 px-2.5 py-1 rounded-full text-xs font-semibold">üì± QR Code</span>
                                    {% else %}
                                        <span class="inline-flex items-center gap-1.5 text-purple-700 bg-purple-50 px-2.5 py-1 rounded-full text-xs font-semibold">üè¶ ‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</span>
                                    {% endif %}
                                </td>
                                <td class="px-6 py-4 text-right font-bold text-slate-800 whitespace-nowrap">{{ pay.amount|floatformat:2|intcomma }}</td>
                                {% if is_owner %}
                                    <td class="px-6 py-4 text-slate-600 font-medium whitespace-nowrap">
                                        <div class="flex items-center gap-2">
                                            <div class="w-6 h-6 rounded-full bg-gray-100 text-gray-500 flex items-center justify-center text-xs">
                                                {{ pay.transaction.created_by.username|slice:":1"|upper }}
                                            </div>
                                            {{ pay.transaction.created_by.username }}
                                        </div>
                                    </td>
                                {% endif %}
                            </tr>
                            {% empty %}
                            <tr><td colspan="5" class="px-6 py-12 text-center text-slate-400 font-medium">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°</td></tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>

        </div>
        
    </main>
</div>

{# JS ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏£‡∏≤‡∏ü #}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const ctx = document.getElementById('salesChart').getContext('2d');
        
        const labels = [{% for d in last_7_days %}"{{ d.day_name }}",{% endfor %}];
        const data = [{% for d in last_7_days %}{{ d.total }},{% endfor %}];
        const isOwner = {% if is_owner %}true{% else %}false{% endif %};

        // ‡∏™‡∏µ Theme ‡πÉ‡∏´‡∏°‡πà (Indigo / Sky)
        // ‡πÉ‡∏ä‡πâ Gradient ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏£‡∏≤‡∏ü
        let gradient = ctx.createLinearGradient(0, 0, 0, 400);
        if (isOwner) {
            gradient.addColorStop(0, 'rgba(99, 102, 241, 0.8)'); // Indigo 500
            gradient.addColorStop(1, 'rgba(99, 102, 241, 0.1)');
        } else {
            gradient.addColorStop(0, 'rgba(14, 165, 233, 0.8)'); // Sky 500
            gradient.addColorStop(1, 'rgba(14, 165, 233, 0.1)');
        }
        
        const borderColor = isOwner ? '#6366f1' : '#0ea5e9';

        new Chart(ctx, {
            type: 'line', // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏£‡∏≤‡∏ü‡πÄ‡∏™‡πâ‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏î‡∏π Flow ‡∏Å‡∏ß‡πà‡∏≤
            data: {
                labels: labels,
                datasets: [{
                    label: isOwner ? '‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢ (‡∏ö‡∏≤‡∏ó)' : '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ö‡∏¥‡∏• (‡πÉ‡∏ö)',
                    data: data,
                    borderColor: borderColor,
                    backgroundColor: gradient,
                    fill: true, // ‡∏ñ‡∏°‡∏™‡∏µ‡πÉ‡∏ï‡πâ‡∏Å‡∏£‡∏≤‡∏ü
                    tension: 0.4, // ‡πÄ‡∏™‡πâ‡∏ô‡πÇ‡∏Ñ‡πâ‡∏á
                    pointBackgroundColor: '#ffffff',
                    pointBorderColor: borderColor,
                    pointBorderWidth: 2,
                    pointRadius: 4,
                    pointHoverRadius: 6
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        backgroundColor: '#1e293b',
                        padding: 12,
                        titleFont: { size: 13, family: "'Inter', sans-serif" },
                        bodyFont: { size: 13, family: "'Inter', sans-serif" },
                        cornerRadius: 8,
                        displayColors: false,
                        callbacks: {
                            label: function(context) {
                                let label = context.parsed.y;
                                if (isOwner) {
                                    return '‡∏ø ' + new Intl.NumberFormat('th-TH').format(label);
                                }
                                return label + ' ‡πÉ‡∏ö';
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        grid: {
                            color: '#f1f5f9', // ‡πÄ‡∏™‡πâ‡∏ô Grid ‡∏™‡∏µ‡∏à‡∏≤‡∏á‡πÜ
                            drawBorder: false,
                        },
                        ticks: {
                            color: '#94a3b8',
                            font: { size: 11, family: "'Inter', sans-serif" },
                            callback: function(value) {
                                if (isOwner && value >= 1000) return value / 1000 + 'k';
                                return value;
                            }
                        }
                    },
                    x: {
                        grid: { display: false },
                        ticks: {
                            color: '#94a3b8',
                            font: { size: 12, family: "'Inter', sans-serif" }
                        }
                    }
                }
            }
        });
    });
</script>

</body>
</html>