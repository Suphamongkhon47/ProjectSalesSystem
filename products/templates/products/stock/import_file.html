{% load tailwind_tags %}
<!doctype html>
<html lang="th" data-theme="light">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå</title>
  {% tailwind_css %}
  <style>
    ::-webkit-scrollbar { width: 8px; height: 8px; }
    ::-webkit-scrollbar-track { background: #f1f1f1; }
    ::-webkit-scrollbar-thumb { background: #888; border-radius: 4px; }
    .drag-over {
      border-color: #3b82f6 !important;
      background-color: #eff6ff !important;
    }
  </style>
</head>
<body class="bg-base-200">
<div class="flex min-h-screen">

  {% include "partials/sidebar.html" %}

  <main class="flex-1 p-8 overflow-y-auto">
    <div class="max-w-6xl mx-auto">
      
      {# Header #}
      <div class="mb-8">
        <div class="flex items-center gap-3 mb-2">
          <a href="{% url 'import_product' %}" class="btn btn-ghost btn-sm">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
            </svg>
            ‡∏Å‡∏•‡∏±‡∏ö
          </a>
          <h1 class="text-3xl font-bold text-gray-800">üìÑ ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå</h1>
        </div>
        <p class="text-gray-600">‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå Excel ‡∏´‡∏£‡∏∑‡∏≠ CSV ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏´‡∏•‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô</p>
      </div>

      {# Messages #}
      {% if messages %}
        <div class="mb-6 space-y-2">
          {% for m in messages %}
            <div class="alert {% if m.tags == 'success' %}alert-success{% elif m.tags == 'error' %}alert-error{% elif m.tags == 'warning' %}alert-warning{% else %}alert-info{% endif %} shadow-lg">
              <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24">
                {% if m.tags == 'success' %}
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                {% else %}
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" />
                {% endif %}
              </svg>
              <span>{{ m|safe }}</span>
            </div>
          {% endfor %}
        </div>
      {% endif %}

      {# ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ #}
      <div class="card bg-gradient-to-br from-blue-50 to-blue-100 shadow-xl mb-8">
        <div class="card-body">
          <h2 class="card-title text-xl mb-4">üìã ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö</h2>
          
          <div class="grid md:grid-cols-2 gap-4">
            <div class="alert">
              <span class="text-2xl">üìä</span>
              <div>
                <div class="font-bold">Excel (.xlsx, .xls)</div>
                <div class="text-sm opacity-80">‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ - ‡∏á‡πà‡∏≤‡∏¢‡∏ï‡πà‡∏≠‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</div>
              </div>
            </div>
            <div class="alert">
              <span class="text-2xl">üìÑ</span>
              <div>
                <div class="font-bold">CSV (.csv)</div>
                <div class="text-sm opacity-80">‡πÄ‡∏ö‡∏≤ ‡∏£‡∏ß‡∏î‡πÄ‡∏£‡πá‡∏ß</div>
              </div>
            </div>
          </div>

          <div class="divider"></div>

          <div class="space-y-3">
            <h3 class="font-bold">‚úÖ ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô:</h3>
            <div class="grid md:grid-cols-2 gap-2 text-sm">
              <div class="flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-success" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                </svg>
                <span><strong>SKU</strong> - ‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</span>
              </div>
              <div class="flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-success" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                </svg>
                <span><strong>‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</strong> - ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏ï‡πá‡∏°</span>
              </div>
              <div class="flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-success" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                </svg>
                <span><strong>‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</strong> - ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</span>
              </div>
              <div class="flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-success" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                </svg>
                <span><strong>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏∏‡∏ô</strong> - ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç</span>
              </div>
              <div class="flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-success" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                </svg>
                <span><strong>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢</strong> - ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç</span>
              </div>
              <div class="flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-success" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                </svg>
                <span><strong>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</strong> - ‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 0</span>
              </div>
            </div>

            <h3 class="font-bold mt-4">‚ú® ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡πÄ‡∏™‡∏£‡∏¥‡∏° (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö):</h3>
            <div class="grid md:grid-cols-2 gap-2 text-sm">
              <div class="flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-info" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                <span><strong>‡∏£‡∏∏‡πà‡∏ô‡∏£‡∏ñ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ</strong> - ‡πÄ‡∏ä‡πà‡∏ô "Vios 2012, Yaris 2014"</span>
              </div>
              <div class="flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-info" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                <span><strong>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏™‡πà‡∏á</strong> - ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢‡∏™‡πà‡∏á</span>
              </div>
              <div class="flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-info" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                <span><strong>‡∏´‡∏ô‡πà‡∏ß‡∏¢</strong> - ‡∏ä‡∏¥‡πâ‡∏ô, ‡∏Å‡∏•‡πà‡∏≠‡∏á, ‡∏Ñ‡∏π‡πà</span>
              </div>
              <div class="flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-info" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                <span><strong>‡∏ä‡∏¥‡πâ‡∏ô/‡∏´‡∏ô‡πà‡∏ß‡∏¢</strong> - ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ä‡∏¥‡πâ‡∏ô‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢</span>
              </div>
              <div class="flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-info" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                <span><strong>‡∏ú‡∏π‡πâ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤</strong> - ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤</span>
              </div>
              <div class="flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-info" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                <span><strong>‡∏ã‡∏±‡∏û‡∏û‡∏•‡∏≤‡∏¢‡πÄ‡∏≠‡∏≠‡∏£‡πå</strong> - ‡∏ä‡∏∑‡πà‡∏≠‡∏ã‡∏±‡∏û‡∏û‡∏•‡∏≤‡∏¢‡πÄ‡∏≠‡∏≠‡∏£‡πå</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      {# ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå #}
      {% if not stage %}
      <div class="card bg-white shadow-2xl">
        <div class="card-body">
          <div class="flex items-center gap-4 mb-6">
            <div class="badge badge-primary badge-lg">1</div>
            <h2 class="card-title text-2xl">üì§ ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå</h2>
          </div>

          <form method="post" enctype="multipart/form-data" id="uploadForm">
            {% csrf_token %}
            <input type="hidden" name="action" value="upload_file">

            {# Upload Area #}
            <div id="dropZone" class="border-4 border-dashed border-gray-300 rounded-xl p-12 text-center bg-gradient-to-br from-gray-50 to-gray-100 hover:from-blue-50 hover:to-blue-100 transition-all duration-300 cursor-pointer">
              <input type="file" name="file" id="fileInput" accept=".xlsx,.xls,.csv" class="hidden" required>
              
              <div id="uploadPlaceholder">
                <div class="text-6xl mb-4">üìÅ</div>
                <h3 class="text-xl font-bold text-gray-700 mb-2">‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå ‡∏´‡∏£‡∏∑‡∏≠ ‡∏•‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏°‡∏≤‡∏ß‡∏≤‡∏á</h3>
                <p class="text-gray-500 mb-4">‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö: .xlsx, .xls, .csv (‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 20MB / ~10,000 ‡πÅ‡∏ñ‡∏ß)</p>
                <button type="button" onclick="document.getElementById('fileInput').click()" class="btn btn-primary btn-lg gap-2">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                  </svg>
                  ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå
                </button>
              </div>

              <div id="filePreview" class="hidden">
                <div class="text-6xl mb-4">‚úÖ</div>
                <h3 class="text-xl font-bold text-success mb-2">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏•‡πâ‡∏ß</h3>
                <p id="fileName" class="text-lg font-semibold text-gray-700 mb-2"></p>
                <p id="fileSize" class="text-gray-500 mb-4"></p>
                <button type="button" onclick="resetFile()" class="btn btn-ghost btn-sm gap-2">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                  </svg>
                  ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÑ‡∏ü‡∏•‡πå
                </button>
              </div>
            </div>

            {# ‡∏ú‡∏π‡πâ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤ #}
            <div class="form-control mt-6">
              <label class="label">
                <span class="label-text font-semibold text-lg">üë§ ‡∏ú‡∏π‡πâ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤</span>
                <span class="label-text-alt text-gray-500">‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö</span>
              </label>
              <input type="text" name="created_by" class="input input-bordered input-lg" 
                     placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤ (‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå)" 
                     value="{{ request.user.username|default:'' }}">
            </div>

            {# ‡∏ã‡∏±‡∏û‡∏û‡∏•‡∏≤‡∏¢‡πÄ‡∏≠‡∏≠‡∏£‡πå #}
            <div class="form-control mt-6">
              <label class="label">
                <span class="label-text font-semibold text-lg">üè™ ‡∏ã‡∏±‡∏û‡∏û‡∏•‡∏≤‡∏¢‡πÄ‡∏≠‡∏≠‡∏£‡πå</span>
                <span class="label-text-alt text-gray-500">‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö</span>
              </label>
              <select name="supplier" class="select select-bordered select-lg">
                <option value="">‚Äî ‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏ ‚Äî</option>
                {% for s in suppliers %}
                  <option value="{{ s.id }}">{{ s.name }}</option>
                {% endfor %}
              </select>
              <label class="label">
                <span class="label-text-alt text-info">
                  üí° ‡∏ñ‡πâ‡∏≤‡πÑ‡∏ü‡∏•‡πå‡∏°‡∏µ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå "‡∏ã‡∏±‡∏û‡∏û‡∏•‡∏≤‡∏¢‡πÄ‡∏≠‡∏≠‡∏£‡πå" ‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏ó‡∏ô
                </span>
              </label>
            </div>

            {# Buttons #}
            <div class="flex gap-4 mt-8">
              <button type="submit" id="submitBtn" class="btn btn-primary btn-lg flex-1 gap-2" disabled>
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                </svg>
                ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏•‡∏∞‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤
              </button>
              <a href="{% url 'import_product_file' %}" class="btn btn-ghost btn-lg gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
                ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
              </button>
            </div>
          </form>
        </div>
      </div>
      {% endif %}

      {# ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤ #}
      {% if stage %}
      <div class="alert alert-success shadow-lg mb-6">
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current flex-shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
          <div>
            <h3 class="font-bold text-lg">‚úÖ ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</h3>
            <div class="text-sm">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á ‡∏´‡∏≤‡∏Å‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏´‡πâ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•"</div>
          </div>
        </div>
        <button class="btn btn-sm" onclick="window.location.href='?reset=1';">
          ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏°‡πà
        </button>
      </div>

      <div class="card bg-base-100 shadow-xl">
        <div class="card-body">
          <div class="flex justify-between items-center mb-4">
            <h3 class="card-title text-xl">üìã ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤ (‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å)</h3>
            <div class="badge badge-lg badge-success">{{ total_rows }} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div>
          </div>
          
          <div class="overflow-x-auto">
            <table class="table table-zebra table-sm">
              <thead class="bg-gradient-to-r from-violet-500 to-purple-500 text-white">
                <tr>
                  <th class="text-center">#</th>
                  <th>‡∏£‡∏´‡∏±‡∏™</th>
                  <th>‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
                  <th>‡∏´‡∏°‡∏ß‡∏î</th>
                  <th>‡∏£‡∏∏‡πà‡∏ô‡∏£‡∏ñ</th>
                  <th class="text-right">‡∏£‡∏≤‡∏Ñ‡∏≤</th>
                  <th class="text-right">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th>
                  <th>‡∏ú‡∏π‡πâ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤</th>
                </tr>
              </thead>
              <tbody>
                {% for r in stage %}
                <tr>
                  <td class="text-center font-bold">{{ forloop.counter }}</td>
                  <td><span class="badge badge-neutral font-mono font-bold">{{ r.sku }}</span></td>
                  <td>
                    <div class="font-bold">{{ r.name }}</div>
                    <div class="text-xs text-gray-500">
                      ‡∏´‡∏ô‡πà‡∏ß‡∏¢: {{ r.unit }}
                    </div>
                  </td>
                  <td><span class="badge badge-primary badge-sm">{{ r.category_name }}</span></td>
                  <td>
                    {% if r.compatible_models %}
                      <div class="text-xs text-orange-800 bg-orange-50 px-2 py-1 rounded border border-orange-200 max-w-xs">
                        üöó {{ r.compatible_models }}
                      </div>
                    {% else %}
                      <span class="text-gray-400 text-xs">-</span>
                    {% endif %}
                  </td>
                  <td class="text-right">
                    <div class="font-bold text-primary">{{ r.selling_price }}</div>
                    <div class="text-xs text-gray-500">‡∏™‡πà‡∏á: {{ r.wholesale_price|default:"-" }}</div>
                    <div class="text-xs text-gray-500">‡∏ó‡∏∏‡∏ô: {{ r.cost_price }}</div>
                  </td>
                  <td class="text-right">
                    <span class="badge badge-success badge-lg font-bold">
                      {{ r.quantity }} {{ r.unit }}
                    </span>
                  </td>
                  <td>{{ r.created_by|default:"-" }}</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>

          <div class="divider"></div>

          <div class="flex gap-4 justify-between items-center">
            <div class="text-sm text-gray-600">
              <span class="font-bold text-warning">‚ö†Ô∏è ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</span> - ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡∏Å‡∏î‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô
            </div>
            <div class="flex gap-3">
              <form method="post" onsubmit="return confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')">
                {% csrf_token %}
                <input type="hidden" name="action" value="clear_all">
                <button type="submit" class="btn btn-outline btn-error gap-2">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                  </svg>
                  ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                </button>
              </form>
              <form method="post">
                {% csrf_token %}
                <input type="hidden" name="action" value="commit">
                <button type="submit" class="btn btn-success btn-lg gap-2 shadow-lg hover:shadow-xl" onclick="return confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• {{ total_rows }} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                  </svg>
                  ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å {{ total_rows }} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                </button>
              </form>
            </div>
          </div>
        </div>
      </div>
      {% endif %}

    </div>
  </main>
</div>

<script>
  const dropZone = document.getElementById('dropZone');
  const fileInput = document.getElementById('fileInput');
  const uploadPlaceholder = document.getElementById('uploadPlaceholder');
  const filePreview = document.getElementById('filePreview');
  const submitBtn = document.getElementById('submitBtn');

  if (dropZone && fileInput) {
    dropZone.addEventListener('click', (e) => {
      if (e.target.id !== 'fileInput' && !e.target.closest('button[type="button"]')) {
        fileInput.click();
      }
    });

    fileInput.addEventListener('change', handleFile);

    dropZone.addEventListener('dragover', (e) => {
      e.preventDefault();
      dropZone.classList.add('drag-over');
    });

    dropZone.addEventListener('dragleave', () => {
      dropZone.classList.remove('drag-over');
    });

    dropZone.addEventListener('drop', (e) => {
      e.preventDefault();
      dropZone.classList.remove('drag-over');
      const files = e.dataTransfer.files;
      if (files.length > 0) {
        fileInput.files = files;
        handleFile();
      }
    });
  }

  function handleFile() {
    const file = fileInput.files[0];
    if (!file) return;

    const validTypes = ['.xlsx', '.xls', '.csv'];
    const fileExt = '.' + file.name.split('.').pop().toLowerCase();
    
    if (!validTypes.includes(fileExt)) {
      alert('‚ùå ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÑ‡∏ü‡∏•‡πå .xlsx, .xls, .csv ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô');
      resetFile();
      return;
    }

    const maxSize = 20 * 1024 * 1024; // 20MB
    if (file.size > maxSize) {
      alert('‚ùå ‡πÑ‡∏ü‡∏•‡πå‡∏°‡∏µ‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà‡πÄ‡∏Å‡∏¥‡∏ô 20MB');
      resetFile();
      return;
    }

    document.getElementById('fileName').textContent = file.name;
    document.getElementById('fileSize').textContent = formatFileSize(file.size);
    uploadPlaceholder.classList.add('hidden');
    filePreview.classList.remove('hidden');
    submitBtn.disabled = false;
  }

  function resetFile() {
    fileInput.value = '';
    uploadPlaceholder.classList.remove('hidden');
    filePreview.classList.add('hidden');
    submitBtn.disabled = true;
  }

  function formatFileSize(bytes) {
    if (bytes < 1024) return bytes + ' B';
    if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(2) + ' KB';
    return (bytes / (1024 * 1024)).toFixed(2) + ' MB';
  }

  const uploadForm = document.getElementById('uploadForm');
  if (uploadForm) {
    uploadForm.addEventListener('submit', (e) => {
      submitBtn.disabled = true;
      submitBtn.innerHTML = `
        <span class="loading loading-spinner"></span>
        ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î...
      `;
    });
  }
</script>

</body>
</html>