{% load tailwind_tags %}
<!doctype html>
<html lang="th" data-theme="light">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå</title>
  {% tailwind_css %}
</head>
<body class="bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50 min-h-screen">
<div class="flex min-h-screen">

  {% include "partials/sidebar.html" %}

  <main class="flex-1 p-6 overflow-y-auto">
    <div class="container mx-auto px-4" style="max-width: 1600px;">
      
      {# Header #}
      <div class="mb-6">
        <div class="flex items-center gap-3 mb-2">
          <div class="p-3 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-xl shadow-lg">
            <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
            </svg>
          </div>
          <div>
            <h1 class="text-3xl font-bold bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent">
              ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå
            </h1>
            <p class="text-sm text-gray-600">‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î Excel ‡∏´‡∏£‡∏∑‡∏≠ CSV ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏°‡∏≤‡∏Å</p>
          </div>
        </div>
      </div>
      
      {# Messages #}
      {% if messages %}
        <div class="mb-6 space-y-3">
          {% for m in messages %}
            <div class="{% if m.tags == 'success' %}bg-gradient-to-r from-green-50 to-emerald-50 border-green-200 text-green-800{% elif m.tags == 'error' %}bg-gradient-to-r from-red-50 to-rose-50 border-red-200 text-red-800{% else %}bg-gradient-to-r from-blue-50 to-indigo-50 border-blue-200 text-blue-800{% endif %} border-l-4 rounded-r-xl p-4 shadow-md">
              <div class="flex items-center gap-3">
                {% if m.tags == 'success' %}
                  <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                  </svg>
                {% elif m.tags == 'error' %}
                  <svg class="w-6 h-6 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                  </svg>
                {% else %}
                  <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                  </svg>
                {% endif %}
                <span class="font-medium">{{ m|safe }}</span>
              </div>
            </div>
          {% endfor %}
        </div>
      {% endif %}

      {# ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ #}
      <div class="card bg-white shadow-2xl mb-8 overflow-hidden gradient-border">
        <div class="card-body p-6">
          <div class="flex items-center gap-3 mb-6">
            <div class="badge badge-lg badge-primary gap-2 px-4 py-3">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
              </svg>
              ‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
            </div>
          </div>
          
          <div class="grid md:grid-cols-2 gap-4 mb-6">
            <div class="alert shadow-md bg-gradient-to-br from-green-50 to-emerald-50 border-green-200">
              <span class="text-3xl">üìä</span>
              <div>
                <div class="font-bold text-green-800">Excel (.xlsx, .xls)</div>
                <div class="text-sm text-green-700">‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ - ‡∏á‡πà‡∏≤‡∏¢‡∏ï‡πà‡∏≠‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</div>
              </div>
            </div>
            <div class="alert shadow-md bg-gradient-to-br from-blue-50 to-indigo-50 border-blue-200">
              <span class="text-3xl">üìÑ</span>
              <div>
                <div class="font-bold text-blue-800">CSV (.csv)</div>
                <div class="text-sm text-blue-700">‡πÄ‡∏ö‡∏≤ ‡∏£‡∏ß‡∏î‡πÄ‡∏£‡πá‡∏ß</div>
              </div>
            </div>
          </div>

          <div class="divider"></div>

          <div class="space-y-4">
            <div class="flex items-center gap-2">
              <div class="badge badge-success badge-lg">‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô 1</div>
              <h3 class="font-bold text-lg">‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô</h3>
            </div>
            <div class="grid md:grid-cols-3 gap-3 text-sm">
              <div class="flex items-center gap-2 p-3 bg-green-50 rounded-lg border border-green-200">
                <svg class="h-5 w-5 text-green-600 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                </svg>
                <span><strong>SKU</strong> - ‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</span>
              </div>
              <div class="flex items-center gap-2 p-3 bg-green-50 rounded-lg border border-green-200">
                <svg class="h-5 w-5 text-green-600 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                </svg>
                <span><strong>‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</strong></span>
              </div>
              <div class="flex items-center gap-2 p-3 bg-green-50 rounded-lg border border-green-200">
                <svg class="h-5 w-5 text-green-600 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                </svg>
                <span><strong>‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</strong></span>
              </div>
              <div class="flex items-center gap-2 p-3 bg-green-50 rounded-lg border border-green-200">
                <svg class="h-5 w-5 text-green-600 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                </svg>
                <span><strong>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏∏‡∏ô</strong> (‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ã‡∏∑‡πâ‡∏≠)</span>
              </div>
              <div class="flex items-center gap-2 p-3 bg-green-50 rounded-lg border border-green-200">
                <svg class="h-5 w-5 text-green-600 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                </svg>
                <span><strong>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢</strong> (‡∏ï‡πà‡∏≠‡∏ä‡∏¥‡πâ‡∏ô)</span>
              </div>
              <div class="flex items-center gap-2 p-3 bg-green-50 rounded-lg border border-green-200">
                <svg class="h-5 w-5 text-green-600 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                </svg>
                <span><strong>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</strong> (> 0)</span>
              </div>
            </div>

            <div class="divider"></div>

            <div class="flex items-center gap-2">
              <div class="badge badge-info badge-lg">‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô 2</div>
              <h3 class="font-bold text-lg">‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡πÄ‡∏™‡∏£‡∏¥‡∏° (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)</h3>
            </div>
            <div class="grid md:grid-cols-2 gap-3 text-sm">
              <div class="flex items-center gap-2 p-3 bg-blue-50 rounded-lg border border-blue-100 hover:border-blue-300 transition">
                <svg class="h-5 w-5 text-blue-600 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
                <span><strong>‡∏£‡∏∏‡πà‡∏ô‡∏£‡∏ñ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ</strong> - ‡πÄ‡∏ä‡πà‡∏ô "Vios 2012"</span>
              </div>
              <div class="flex items-center gap-2 p-3 bg-blue-50 rounded-lg border border-blue-100 hover:border-blue-300 transition">
                <svg class="h-5 w-5 text-blue-600 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
                <span><strong>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏™‡πà‡∏á</strong> - ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢‡∏™‡πà‡∏á</span>
              </div>
              <div class="flex items-center gap-2 p-3 bg-amber-50 rounded-lg border border-amber-200 hover:border-amber-400 transition">
                <svg class="h-5 w-5 text-amber-600 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
                </svg>
                <span><strong>‡∏ä‡∏¥‡πâ‡∏ô/‡∏´‡∏ô‡πà‡∏ß‡∏¢</strong> - ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ä‡∏¥‡πâ‡∏ô‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ã‡∏∑‡πâ‡∏≠</span>
              </div>
              <div class="flex items-center gap-2 p-3 bg-amber-50 rounded-lg border border-amber-200 hover:border-amber-400 transition">
                <svg class="h-5 w-5 text-amber-600 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
                </svg>
                <span><strong>‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ã‡∏∑‡πâ‡∏≠</strong> - ‡πÄ‡∏ä‡πà‡∏ô ‡∏Å‡∏•‡πà‡∏≠‡∏á, ‡∏ä‡∏∏‡∏î, ‡∏Ñ‡∏π‡πà</span>
              </div>
              <div class="flex items-center gap-2 p-3 bg-blue-50 rounded-lg border border-blue-100 hover:border-blue-300 transition">
                <svg class="h-5 w-5 text-blue-600 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
                <span><strong>‡∏´‡∏ô‡πà‡∏ß‡∏¢</strong> - ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Ç‡∏≤‡∏¢ (‡∏ä‡∏¥‡πâ‡∏ô, ‡∏≠‡∏±‡∏ô)</span>
              </div>
              <div class="flex items-center gap-2 p-3 bg-blue-50 rounded-lg border border-blue-100 hover:border-blue-300 transition">
                <svg class="h-5 w-5 text-blue-600 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
                <span><strong>‡∏ú‡∏π‡πâ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤ / ‡∏ã‡∏±‡∏û‡∏û‡∏•‡∏≤‡∏¢‡πÄ‡∏≠‡∏≠‡∏£‡πå</strong></span>
              </div>
            </div>
            
            <div class="alert alert-warning shadow-lg bg-gradient-to-r from-amber-50 to-orange-50 border-l-4 border-amber-400">
              <div>
                <svg class="stroke-current flex-shrink-0 h-6 w-6 text-amber-600" fill="none" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
                </svg>
                <div>
                  <h3 class="font-bold text-amber-900">üí° ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: ‡∏ã‡∏∑‡πâ‡∏≠‡∏¢‡∏≤‡∏á‡∏ä‡∏∏‡∏î‡∏•‡∏∞ 4 ‡πÄ‡∏™‡πâ‡∏ô</h3>
                  <div class="text-sm text-amber-800 mt-1">
                    ‚Ä¢ <strong>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</strong> = 10 | <strong>‡∏ä‡∏¥‡πâ‡∏ô/‡∏´‡∏ô‡πà‡∏ß‡∏¢</strong> = 4 | <strong>‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ã‡∏∑‡πâ‡∏≠</strong> = ‡∏ä‡∏∏‡∏î<br>
                    ‚Üí ‡∏™‡∏ï‡πá‡∏≠‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏° <span class="badge badge-success">40 ‡πÄ‡∏™‡πâ‡∏ô</span><br>
                    ‚Ä¢ <strong>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏∏‡∏ô</strong> = 800 (‡∏ï‡πà‡∏≠‡∏ä‡∏∏‡∏î) ‚Üí ‡∏ó‡∏∏‡∏ô‡∏ï‡πà‡∏≠‡πÄ‡∏™‡πâ‡∏ô = <span class="badge badge-info">200 ‡∏ö‡∏≤‡∏ó</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      {# ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå #}
      {% if not stage %}
      <div class="card bg-white shadow-2xl">
        <div class="card-body p-6">
          <div class="flex items-center gap-4 mb-6">
            <div class="badge badge-primary badge-lg px-5 py-4 text-lg">1</div>
            <div>
              <h2 class="text-2xl font-bold text-gray-800">üì§ ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå</h2>
              <p class="text-sm text-gray-600">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå Excel ‡∏´‡∏£‡∏∑‡∏≠ CSV ‡∏à‡∏≤‡∏Å‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå</p>
            </div>
          </div>

          <form method="post" enctype="multipart/form-data" id="uploadForm">
            {% csrf_token %}
            <input type="hidden" name="action" value="upload_file">

            {# Upload Area #}
            <div id="dropZone" class="border-4 border-dashed border-gray-300 rounded-2xl p-12 text-center bg-gradient-to-br from-gray-50 to-slate-50 hover:from-blue-50 hover:to-indigo-50 transition-all duration-300 cursor-pointer mb-6">
              <input type="file" name="file" id="fileInput" accept=".xlsx,.xls,.csv" class="hidden" required>
              
              <div id="uploadPlaceholder">
                <div class="text-7xl mb-6 animate-bounce">üìÅ</div>
                <h3 class="text-2xl font-bold text-gray-700 mb-3">‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå ‡∏´‡∏£‡∏∑‡∏≠ ‡∏•‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏°‡∏≤‡∏ß‡∏≤‡∏á</h3>
                <p class="text-gray-500 mb-6">‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö: <span class="badge badge-primary">Excel</span> <span class="badge badge-info">CSV</span> (‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 20MB)</p>
                <button type="button" onclick="document.getElementById('fileInput').click()" class="btn btn-primary btn-lg gap-2 px-8 shadow-lg hover:shadow-xl transition">
                  <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
                  </svg>
                  ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå
                </button>
              </div>

              <div id="filePreview" class="hidden">
                <div class="text-7xl mb-6">‚úÖ</div>
                <h3 class="text-2xl font-bold text-success mb-3">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏•‡πâ‡∏ß</h3>
                <p id="fileName" class="text-xl font-semibold text-gray-700 mb-2"></p>
                <p id="fileSize" class="text-gray-500 mb-6"></p>
                <button type="button" onclick="resetFile()" class="btn btn-ghost gap-2">
                  <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                  </svg>
                  ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÑ‡∏ü‡∏•‡πå
                </button>
              </div>
            </div>

            {# Form Fields #}
            <div class="grid md:grid-cols-2 gap-4 mb-6">
              <div class="form-control">
                <label class="label">
                  <span class="label-text font-semibold text-base flex items-center gap-2">
                    <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                    </svg>
                    üë§ ‡∏ú‡∏π‡πâ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤
                  </span>
                  <span class="label-text-alt badge badge-ghost">‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö</span>
                </label>
                <input type="text" name="created_by" class="input input-bordered input-lg" 
                       placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤" 
                       value="{{ request.user.username|default:'' }}">
              </div>

              <div class="form-control">
                <label class="label">
                  <span class="label-text font-semibold text-base flex items-center gap-2">
                    <svg class="w-5 h-5 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
                    </svg>
                    üè™ ‡∏ã‡∏±‡∏û‡∏û‡∏•‡∏≤‡∏¢‡πÄ‡∏≠‡∏≠‡∏£‡πå
                  </span>
                  <span class="label-text-alt badge badge-ghost">‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö</span>
                </label>
                <select name="supplier" class="select select-bordered select-lg">
                  <option value="">‚Äî ‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏ ‚Äî</option>
                  {% for s in suppliers %}
                    <option value="{{ s.id }}">{{ s.name }}</option>
                  {% endfor %}
                </select>
                <label class="label">
                  <span class="label-text-alt text-info flex items-center gap-1">
                    <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                    ‡∏ñ‡πâ‡∏≤‡πÑ‡∏ü‡∏•‡πå‡∏°‡∏µ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå "‡∏ã‡∏±‡∏û‡∏û‡∏•‡∏≤‡∏¢‡πÄ‡∏≠‡∏≠‡∏£‡πå" ‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏ó‡∏ô
                  </span>
                </label>
              </div>
            </div>

            {# Buttons #}
            <div class="flex gap-4 justify-end">
              <a href="{% url 'import_product_file' %}" class="btn btn-ghost btn-lg gap-2">
                <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
                ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
              </a>
              <button type="submit" id="submitBtn" class="btn btn-primary btn-lg gap-2 px-8 shadow-lg hover:shadow-xl transition" disabled>
                <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
                </svg>
                ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏•‡∏∞‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤
              </button>
            </div>
          </form>
        </div>
      </div>
      {% endif %}

      {# ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤ #}
      {% if stage %}
      <div class="alert alert-success shadow-xl mb-6 bg-gradient-to-r from-green-50 to-emerald-50 border-l-4 border-green-400">
        <div>
          <svg class="stroke-current flex-shrink-0 h-8 w-8 text-green-600" fill="none" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
          </svg>
          <div>
            <h3 class="font-bold text-xl text-green-800">‚úÖ ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</h3>
            <div class="text-sm text-green-700 mt-1">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á ‡∏´‡∏≤‡∏Å‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏´‡πâ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•"</div>
          </div>
        </div>
        <button class="btn btn-ghost gap-2" onclick="window.location.href='?reset=1';">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
          </svg>
          ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏°‡πà
        </button>
      </div>

      <div class="card bg-white shadow-2xl">
        <div class="card-body p-6">
          <div class="flex justify-between items-center mb-4">
            <div>
              <h3 class="text-2xl font-bold text-gray-800 flex items-center gap-3">
                üìã ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤
                <span class="badge badge-warning text-sm">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</span>
              </h3>
              <p class="text-sm text-gray-600 mt-1">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡πà‡∏≠‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</p>
            </div>
            <div class="badge badge-lg badge-success gap-2 px-6 py-4">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
              </svg>
              {{ total_rows }} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
            </div>
          </div>
          
          <div class="overflow-x-auto rounded-xl border border-gray-200">
            <table class="table table-zebra">
              <thead class="bg-gradient-to-r from-violet-600 to-purple-600 text-white">
                <tr>
                  <th class="text-center">#</th>
                  <th>‡∏£‡∏´‡∏±‡∏™</th>
                  <th>‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
                  <th>‡∏´‡∏°‡∏ß‡∏î</th>
                  <th>‡∏£‡∏∏‡πà‡∏ô‡∏£‡∏ñ</th>
                  <th class="text-right">‡∏£‡∏≤‡∏Ñ‡∏≤</th>
                  <th class="text-right">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th>
                  <th>‡∏ú‡∏π‡πâ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤</th>
                </tr>
              </thead>
              <tbody>
                {% for r in stage %}
                <tr class="hover:bg-blue-50 transition">
                  <td class="text-center">
                    <div class="badge badge-neutral font-bold">{{ forloop.counter }}</div>
                  </td>
                  <td>
                    <span class="badge badge-ghost font-mono font-bold text-sm">{{ r.sku }}</span>
                  </td>
                  <td>
                    <div class="font-bold text-gray-800">{{ r.name }}</div>
                    <div class="text-xs text-gray-500 flex items-center gap-2 mt-1">
                      <span class="badge badge-sm badge-outline">{{ r.unit }}</span>
                      {% if r.items_per_purchase_unit > 1 %}
                        <span class="badge badge-sm badge-warning">{{ r.items_per_purchase_unit }} ‡∏ä‡∏¥‡πâ‡∏ô/{{ r.purchase_unit_name }}</span>
                      {% endif %}
                    </div>
                  </td>
                  <td>
                    <span class="badge badge-primary">{{ r.category_name }}</span>
                  </td>
                  <td>
                    {% if r.compatible_models %}
                      <div class="text-xs text-orange-800 bg-orange-50 px-3 py-1.5 rounded-lg border border-orange-200 max-w-xs">
                        üöó {{ r.compatible_models }}
                      </div>
                    {% else %}
                      <span class="text-gray-400 text-xs">‚Äî</span>
                    {% endif %}
                  </td>
                  <td class="text-right">
                    <div class="font-bold text-primary text-lg">{{ r.selling_price }}</div>
                    <div class="text-xs text-gray-500">‡∏™‡πà‡∏á: {{ r.wholesale_price|default:"‚Äî" }}</div>
                    <div class="text-xs text-gray-500">‡∏ó‡∏∏‡∏ô: {{ r.cost_price }}</div>
                  </td>
                  <td class="text-right">
                    <span class="badge badge-success badge-lg font-bold">
                      {{ r.quantity }} {{ r.purchase_unit_name|default:r.unit }}
                    </span>
                  </td>
                  <td>
                    <span class="text-sm text-gray-600">{{ r.created_by|default:"‚Äî" }}</span>
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>

          <div class="divider my-6"></div>

          <div class="flex gap-4 justify-between items-center">
            <div class="alert alert-warning flex-1">
              <svg class="stroke-current flex-shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
              </svg>
              <span><strong>‚ö†Ô∏è ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</strong> - ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡∏Å‡∏î‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</span>
            </div>
            <div class="flex gap-3">
              <form method="post" onsubmit="return confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')">
                {% csrf_token %}
                <input type="hidden" name="action" value="clear_all">
                <button type="submit" class="btn btn-outline btn-error gap-2">
                  <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                  </svg>
                  ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                </button>
              </form>
              <form method="post">
                {% csrf_token %}
                <input type="hidden" name="action" value="commit">
                <button type="submit" class="btn btn-success btn-lg gap-2 shadow-lg hover:shadow-xl px-8" onclick="return confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• {{ total_rows }} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')">
                  <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                  </svg>
                  ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å {{ total_rows }} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                </button>
              </form>
            </div>
          </div>
        </div>
      </div>
      {% endif %}

    </div>
  </main>
</div>

<script>
  const dropZone = document.getElementById('dropZone');
  const fileInput = document.getElementById('fileInput');
  const uploadPlaceholder = document.getElementById('uploadPlaceholder');
  const filePreview = document.getElementById('filePreview');
  const submitBtn = document.getElementById('submitBtn');

  if (dropZone && fileInput) {
    dropZone.addEventListener('click', (e) => {
      if (e.target.id !== 'fileInput' && !e.target.closest('button[type="button"]')) {
        fileInput.click();
      }
    });

    fileInput.addEventListener('change', handleFile);

    dropZone.addEventListener('dragover', (e) => {
      e.preventDefault();
      dropZone.classList.add('drag-over');
    });

    dropZone.addEventListener('dragleave', () => {
      dropZone.classList.remove('drag-over');
    });

    dropZone.addEventListener('drop', (e) => {
      e.preventDefault();
      dropZone.classList.remove('drag-over');
      const files = e.dataTransfer.files;
      if (files.length > 0) {
        fileInput.files = files;
        handleFile();
      }
    });
  }

  function handleFile() {
    const file = fileInput.files[0];
    if (!file) return;

    const validTypes = ['.xlsx', '.xls', '.csv'];
    const fileExt = '.' + file.name.split('.').pop().toLowerCase();
    
    if (!validTypes.includes(fileExt)) {
      alert('‚ùå ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÑ‡∏ü‡∏•‡πå .xlsx, .xls, .csv ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô');
      resetFile();
      return;
    }

    const maxSize = 20 * 1024 * 1024; // 20MB
    if (file.size > maxSize) {
      alert('‚ùå ‡πÑ‡∏ü‡∏•‡πå‡∏°‡∏µ‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà‡πÄ‡∏Å‡∏¥‡∏ô 20MB');
      resetFile();
      return;
    }

    document.getElementById('fileName').textContent = file.name;
    document.getElementById('fileSize').textContent = formatFileSize(file.size);
    uploadPlaceholder.classList.add('hidden');
    filePreview.classList.remove('hidden');
    submitBtn.disabled = false;
  }

  function resetFile() {
    fileInput.value = '';
    uploadPlaceholder.classList.remove('hidden');
    filePreview.classList.add('hidden');
    submitBtn.disabled = true;
  }

  function formatFileSize(bytes) {
    if (bytes < 1024) return bytes + ' B';
    if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(2) + ' KB';
    return (bytes / (1024 * 1024)).toFixed(2) + ' MB';
  }

  const uploadForm = document.getElementById('uploadForm');
  if (uploadForm) {
    uploadForm.addEventListener('submit', (e) => {
      submitBtn.disabled = true;
      submitBtn.innerHTML = `
        <span class="loading loading-spinner"></span>
        ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î...
      `;
    });
  }
</script>

</body>
</html>